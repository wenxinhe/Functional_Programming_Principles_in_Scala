define("bundles/discussions/components/discussionsBody/ThreadsList",["require","exports","module","react","underscore","bundles/discussions/actions/ThreadsActions","bundles/discussions/components/ControlsBar","bundles/discussions/components/ListBody","bundles/discussions/components/NewThreadButton","bundles/discussions/components/discussionsBody/ThreadsListEntry","bundles/discussions/constants","bundles/discussions/utils/discussionsUrl","bundles/discussions/utils/discussionsUrl","bundles/discussions/utils/unreadTracker","bundles/discussions/viewModels/viewContext","bundles/page/components/PaginationControls","bundles/discussions/utils/discussionsApiRolloutUtil","bundles/naptimejs/resources/onDemandCourseForums.v1","bundles/naptimejs/resources/onDemandMentorForums.v1","js/lib/connectToRouter","bundles/discussions/utils/routerConnectToCurrentForum","bundles/discussions/components/discussionsForumsHOC","js/lib/waitFor","vendor/cnpm/fluxible.v0-4/addons/connectToStores","i18n!nls/discussions","css!bundles/discussions/components/discussionsBody/__styles__/ThreadsList","css!bundles/page/components/__styles__/PaginationControls.css"],function(require,exports,module){"use strict";function _defaults(e,n){for(var r=Object.getOwnPropertyNames(n),s=0;s<r.length;s++){var t=r[s],o=Object.getOwnPropertyDescriptor(n,t);o&&o.configurable&&void 0===e[t]&&Object.defineProperty(e,t,o)}return e}function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(s,e){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?s:e}function _inherits(s,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(s,e):_defaults(s,e))}var s,o,t,n,e=require("react"),h=require("underscore"),g=h.compose,w=require("bundles/discussions/actions/ThreadsActions"),i=w.loadThreads,S=require("bundles/discussions/components/ControlsBar"),N=require("bundles/discussions/components/ListBody"),l=require("bundles/discussions/components/NewThreadButton").NewThreadButtonNaptimeContainer,m=require("bundles/discussions/components/discussionsBody/ThreadsListEntry"),y=require("bundles/discussions/constants"),p=y.loadingStates,u=require("bundles/discussions/utils/discussionsUrl"),f=require("bundles/discussions/utils/discussionsUrl"),b=f.getAllThreadsDiscussionsUrl,T=require("bundles/discussions/utils/unreadTracker"),v=require("bundles/discussions/viewModels/viewContext"),C=require("bundles/page/components/PaginationControls"),P=require("bundles/discussions/utils/discussionsApiRolloutUtil"),a=P.useNewForumApis,c=require("bundles/naptimejs/resources/onDemandCourseForums.v1"),d=require("bundles/naptimejs/resources/onDemandMentorForums.v1"),F=require("js/lib/connectToRouter"),x=require("bundles/discussions/utils/routerConnectToCurrentForum"),O=require("bundles/discussions/components/discussionsForumsHOC"),j=require("js/lib/waitFor"),A=require("vendor/cnpm/fluxible.v0-4/addons/connectToStores"),r=require("i18n!nls/discussions");require("css!bundles/discussions/components/discussionsBody/__styles__/ThreadsList"),require("css!bundles/page/components/__styles__/PaginationControls.css");var B=(o=s=function(s){function ThreadsList(){var n,t,i;_classCallCheck(this,ThreadsList);for(var c=arguments.length,d=Array(c),o=0;c>o;o++)d[o]=arguments[o];return n=t=_possibleConstructorReturn(this,s.call.apply(s,[this].concat(d))),t.state={inSearch:!1},t.onPageChange=function(e){var s=t.context.router;s.push({pathname:t.context.router.location.pathname,params:{},query:Object.assign(t.context.router.location.query,{page:e})})},t.toggleSearch=function(){t.setState({inSearch:!t.state.inSearch})},t.renderEntry=function(s){var C=t.props.activeFilterQueryString,y=s.lastAnsweredAt&&s.lastAnsweredBy,S=!T.hasUnread(s),P=y?s.lastAnsweredBy:s.creator,h=r(y?"Last post by":"Created by"),c=void 0,d=void 0;if(a()){var o=t.props,g=o.courseForums,x=o.mentorForums,f=o.currentForum,b=o.currentForumUrl,v=g.concat(x),i=v.find(function(e){return e.forumId===s.forumId});c=i&&f.id!==i.id&&i.title||void 0,d=u.getDeepLink(b,s)}else{var l=t.context.viewContext,w=t.props.forumMetadatas,n=w[s.context.definition.forumId];c=n&&n.id!==l.get("id")&&n.title||void 0,d=u.getDeepLink(l.get("discussionsLink"),s)}var F="undefined"!=typeof s.answerCount&&!isNaN(s.answerCount),p=F?s.answerCount:s.totalAnswerCount;return e.createElement(m,{key:s.id+C,threadUrl:d,profile:P,timestamp:s.lastAnsweredAt||s.createdAt,threadName:s.content.question,questionId:s.id,questionUserId:s.creatorId,entry:s,isPinned:!(!s.state||!s.state.pinned),isDeleted:!(!s.state||!s.state.deleted),isRead:S,forumName:c,metadataLabel:h,viewCount:Math.max(p,s.viewCount),answerCount:p,badge:s.answerBadge.answerBadge})},i=n,_possibleConstructorReturn(t,i)}return _inherits(ThreadsList,s),ThreadsList.prototype.componentWillMount=function componentWillMount(){var e=this.props,t=e.sort,o=e.page,s=e.currentForum,n=e.activeFilterQueryString,r=this.context.viewContext;this.context.executeAction(i,{filterQueryString:n,sort:t,pageNum:o,viewContext:r,forumType:s&&s.forumType.typeName,forumId:s&&s.id,userId:this.props.userId,includeDeleted:this.props.hasModerationRole})},ThreadsList.prototype.componentWillUpdate=function componentWillUpdate(e,n,t){var o=a()?this.props.currentForumId!==e.currentForumId:this.context.viewContext.get("id")!==t.viewContext.get("id");if(this.props.sort!==e.sort||this.props.page!==e.page||o||this.props.activeFilterQueryString!==e.activeFilterQueryString){var s=this.props.currentForum;this.context.executeAction(i,{filterQueryString:e.activeFilterQueryString,sort:e.sort,pageNum:e.page,viewContext:t.viewContext,forumType:s&&s.forumType.typeName,forumId:s&&s.id,userId:this.props.userId,includeDeleted:this.props.hasModerationRole})}},ThreadsList.prototype.render=function render(){var s=this.context.router.isActive({pathname:b()});return e.createElement("div",{className:"rc-ThreadsList styleguide horizontal-box"},e.createElement("div",{className:"flex-2"},e.createElement("div",{className:"card-rich-interaction"},e.createElement(S,{sort:this.props.sort,inSearch:this.state.inSearch,toggleSearch:this.toggleSearch,showSearchBox:!s}),e.createElement(N,{emptyStatePlaceholderText:r("No Posts Yet"),fossilized:this.state.inSearch,loadingState:this.props.loadingState},this.props.entries&&this.props.entries.map(this.renderEntry))),e.createElement(C,{onPageChange:this.onPageChange,pageCount:this.props.pageCount,currentPage:this.props.page,maxPages:5})))},ThreadsList}(e.Component),s.propTypes={courseForums:e.PropTypes.arrayOf(e.PropTypes.instanceOf(c)),mentorForums:e.PropTypes.arrayOf(e.PropTypes.instanceOf(d)),currentForumId:e.PropTypes.string,currentForum:e.PropTypes.oneOfType([e.PropTypes.instanceOf(c),e.PropTypes.instanceOf(d)]),sort:e.PropTypes.string.isRequired,page:e.PropTypes.number.isRequired,videoPlayer:e.PropTypes.object,entries:e.PropTypes.array,loadingState:e.PropTypes.oneOf(Object.keys(p)),pageCount:e.PropTypes.number,threadCount:e.PropTypes.number,activeFilterQueryString:e.PropTypes.string,forumMetadatas:e.PropTypes.object,userId:e.PropTypes.number,hasModerationRole:e.PropTypes.bool,currentForumUrl:e.PropTypes.string},s.contextTypes={viewContext:e.PropTypes.instanceOf(v),executeAction:e.PropTypes.func.isRequired,router:e.PropTypes.object.isRequired},o),I=(n=t=function(s){function ThreadsListContainer(){return _classCallCheck(this,ThreadsListContainer),_possibleConstructorReturn(this,s.apply(this,arguments))}return _inherits(ThreadsListContainer,s),ThreadsListContainer.prototype.render=function render(){if(!this.props.currentForum&&!this.context.viewContext)return null;return e.createElement(B,this.props)},ThreadsListContainer}(e.Component),t.propTypes={currentForum:e.PropTypes.object},t.contextTypes={viewContext:e.PropTypes.object},n);module.exports=g(A(["SessionFilterStore","ForumMetadataStore","ThreadsStore","ApplicationStore"],function(e){var t=e.SessionFilterStore,o=e.ForumMetadataStore,s=e.ThreadsStore,n=e.ApplicationStore;return{activeFilterQueryString:t.activeFilterQueryString,forumMetadatas:o.getAllForumMetadatas(),entries:s.getThreadsPage(),loadingState:s.getLoadingState(),pageCount:s.getPageCount(),threadCount:s.getThreadCount(),userId:n.getUserData().id}}),O({fields:["title","link","forumType"],subcomponents:[l]}),F(x),j(function(e){return!(void 0===e.activeFilterQueryString||!e.sort||!e.page)}))(I)});
define("bundles/discussions/components/sessionSwitcher/SessionSwitcherDropdown",["require","exports","module","underscore","react","moment","react-bootstrap","vendor/cnpm/fluxible.v0-4/addons/connectToStores","js/lib/waitFor","js/lib/coursera.react-intl","i18n!nls/discussions","css!./__styles__/SessionSwitcherDropdown"],function(require,exports,module){"use strict";function _defaults(e,i){for(var s=Object.getOwnPropertyNames(i),t=0;t<s.length;t++){var r=s[t],n=Object.getOwnPropertyDescriptor(i,r);n&&n.configurable&&void 0===e[r]&&Object.defineProperty(e,r,n)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}var r,n,_=require("underscore"),e=require("react"),t=require("moment"),i=require("react-bootstrap"),l=i.DropdownButton,a=i.MenuItem,d=require("vendor/cnpm/fluxible.v0-4/addons/connectToStores"),p=require("js/lib/waitFor"),c=require("js/lib/coursera.react-intl"),u=c.FormattedMessage,s=require("i18n!nls/discussions");require("css!./__styles__/SessionSwitcherDropdown");var o="MMM DD, YYYY",f=(n=r=function(r){function SessionSwitcherDropdown(i,o){_classCallCheck(this,SessionSwitcherDropdown);var n=_possibleConstructorReturn(this,r.call(this,i,o));return n.handleDropdownChange=function(e){n.setState({selectedFilter:n.props.filters.find(function(t){return t.id===e})}),n.props.handleDropdownChange(e)},n.buildMenuItemDisplay=function(r,i){if("all"===r.id)return SessionSwitcherDropdown.buildFilterDisplayString(r,i);if("ondemand"===r.id)return e.createElement("div",{className:"horizontal-box"},SessionSwitcherDropdown.buildFilterDisplayString(r,i),"ondemand"===r.id&&i&&e.createElement("div",{className:"menu-item-label caption-text color-secondary-text"},s("Active")));var o=n.props.allSessions.find(function(e){return e.id===r.id}),l=_(o.moduleDeadlines).chain().sortBy(function(e){return e.startedAt}).find(function(e){return t(e.deadline).isAfter(t())}).value(),a=l&&t(l).diff(t(o.startedAt),"weeks")+1;return e.createElement("div",{className:"horizontal-box"},SessionSwitcherDropdown.buildFilterDisplayString(r,i),i&&a>0&&t(o.endedAt).isAfter(t())&&e.createElement("div",{className:"menu-item-label caption-text color-secondary-text"},e.createElement(u,{message:s("Week {weekNumber} assignment due"),weekNumber:a})))},"all"===i.selectedFilter.id&&i.hideAllSessionsOption?n.state={selectedFilter:i.filters.filter(function(e){return"all"!==e.id})[0]}:n.state={selectedFilter:i.selectedFilter},n}return _inherits(SessionSwitcherDropdown,r),SessionSwitcherDropdown.prototype.componentWillMount=function componentWillMount(){this.props.selectedFilter.id!==this.state.selectedFilter.id&&this.props.handleDropdownChange(this.state.selectedFilter.id)},SessionSwitcherDropdown.buildFilterDisplayString=function buildFilterDisplayString(e,n){if("ondemand"===e.id)return"Self Paced";if("all"===e.id)return"All Sessions";var i=t(e.startedAt).format(o),s=t(e.endedAt).format(o),r=i+" - "+s;return e.variantLabel&&n?r+": "+e.variantLabel:r},SessionSwitcherDropdown.prototype.render=function render(){var t=this;return e.createElement("div",{className:"rc-SessionSwitcherDropdown"},e.createElement("div",{className:"dropdown-section"},e.createElement(l,{id:this.props.id,title:this.buildMenuItemDisplay(this.state.selectedFilter,!1),onSelect:this.handleDropdownChange,disabled:this.props.disabled,dropup:this.props.dropup,pullRight:!0},this.props.filters.map(function(r){return e.createElement(a,{key:r.id,eventKey:r.id},t.buildMenuItemDisplay(r,!0))}))))},SessionSwitcherDropdown}(e.Component),r.propTypes={id:e.PropTypes.string,filters:e.PropTypes.arrayOf(e.PropTypes.shape({id:e.PropTypes.string.isRequired,startedAt:e.PropTypes.number,endedAt:e.PropTypes.number})),selectedFilter:e.PropTypes.shape({id:e.PropTypes.string.isRequired,startedAt:e.PropTypes.number,endedAt:e.PropTypes.number}),allSessions:e.PropTypes.array,handleDropdownChange:e.PropTypes.func.isRequired,hideAllSessionsOption:e.PropTypes.bool,disabled:e.PropTypes.bool,dropup:e.PropTypes.bool},r.defaultProps={hideAllSessionsOption:!1,dropup:!1},n);module.exports=_.compose(d(["SessionFilterStore"],function(r,n){var e=r.SessionFilterStore,t=e.filters;return n.hideAllSessionsOption&&(t=t.filter(function(e){return"all"!==e.id})),{loaded:e.filtersLoaded,filters:t,sessionsLoaded:e.filtersLoaded,selectedFilter:e.activeFilter,allSessions:e.allSessions}}),p(function(e){return e.loaded}))(f)});
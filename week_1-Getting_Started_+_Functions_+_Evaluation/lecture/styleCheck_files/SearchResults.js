define("bundles/discussions/components/search/SearchResults",["require","exports","module","underscore","react","bundles/discussions/viewModels/viewContext","bundles/discussions/constants","bundles/discussions/actions/DiscussionsSearchActions","bundles/discussions/components/ListBody","bundles/discussions/components/search/SearchBar","bundles/discussions/components/search/SearchResultEntry","bundles/page/components/PaginationControls","js/lib/path","js/lib/connectToRouter","vendor/cnpm/fluxible.v0-4/addons/connectToStores","js/lib/waitFor","bundles/discussions/utils/discussionsUrl","bundles/discussions/utils/routerConnectToCurrentForum","bundles/naptimejs/resources/onDemandCourseForums.v1","bundles/naptimejs/resources/onDemandMentorForums.v1","bundles/discussions/utils/discussionsApiRolloutUtil","bundles/discussions/components/discussionsForumsHOC","js/lib/coursera.react-intl","i18n!nls/discussions","css!./__styles__/SearchResults","css!bundles/page/components/__styles__/PaginationControls.css"],function(require,exports,module){"use strict";function _defaults(e,n){for(var o=Object.getOwnPropertyNames(n),s=0;s<o.length;s++){var t=o[s],r=Object.getOwnPropertyDescriptor(n,t);r&&r.configurable&&void 0===e[t]&&Object.defineProperty(e,t,r)}return e}function _classCallCheck(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(s,e){if(!s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?s:e}function _inherits(s,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(s,e):_defaults(s,e))}var r,i,y=require("underscore"),P=y.compose,e=require("react"),F=require("bundles/discussions/viewModels/viewContext"),l=require("bundles/discussions/constants"),n=l.loadingStates,o=require("bundles/discussions/actions/DiscussionsSearchActions"),p=require("bundles/discussions/components/ListBody"),d=require("bundles/discussions/components/search/SearchBar"),m=require("bundles/discussions/components/search/SearchResultEntry"),c=require("bundles/page/components/PaginationControls"),h=require("js/lib/path"),u=require("js/lib/connectToRouter"),g=require("vendor/cnpm/fluxible.v0-4/addons/connectToStores"),f=require("js/lib/waitFor"),b=require("bundles/discussions/utils/discussionsUrl"),v=b.getAllThreadsDiscussionsUrl,S=require("bundles/discussions/utils/routerConnectToCurrentForum"),C=require("bundles/naptimejs/resources/onDemandCourseForums.v1"),q=require("bundles/naptimejs/resources/onDemandMentorForums.v1"),x=require("bundles/discussions/utils/discussionsApiRolloutUtil"),s=x.useNewForumApis,w=require("bundles/discussions/components/discussionsForumsHOC"),T=require("js/lib/coursera.react-intl"),a=T.FormattedMessage,t=require("i18n!nls/discussions");require("css!./__styles__/SearchResults"),require("css!bundles/page/components/__styles__/PaginationControls.css");var R=(i=r=function(r){function SearchResults(t,n){_classCallCheck(this,SearchResults);var e=_possibleConstructorReturn(this,r.call(this,t,n));return e.handleQueryChange=function(s){e.setState({query:s})},e.handleSearchCourse=function(s){s.preventDefault();var t=h.join(e.props.rootPath,"discussions/all");e.context.router.push({pathname:t,params:{},query:{q:e.state.query}})},e.onPageChange=function(s){e.context.router.push({pathname:e.context.router.location.pathname,params:{},query:Object.assign(e.context.router.location.query,{page:s})}),e.context.executeAction(o.goToPage,{query:e.props.query,pageNum:s,viewContext:e.props.viewContext,forum:e.props.currentForum,courseId:e.props.courseId})},e.submitSearch=function(){if(e.state.query){var s=e.state.query.replace("*","");e.context.router.push({pathname:window.location.pathname,params:{},query:{q:s}})}},e.navigateBack=function(t){t.preventDefault();var r=s()?e.props.currentForumUrl:e.props.viewContext.get("discussionsLink");e.context.router.push(r)},e.state={query:t.query||""},t.query&&e.context.executeAction(o.search,{query:t.query,filterQueryString:t.filterQueryString,pageNum:t.page,viewContext:t.viewContext,forum:t.currentForum,reset:!0,courseId:t.courseId}),e}return _inherits(SearchResults,r),SearchResults.prototype.componentWillReceiveProps=function componentWillReceiveProps(e,s,t){(e.query!==this.props.query||e.pathname!==this.props.pathname||this.props.viewContext&&e.viewContext.get("id")!==this.props.viewContext.get("id")||this.props.currentForum&&e.currentForum.id!==this.props.currentForum.id||e.filterQueryString!==this.props.filterQueryString)&&(this.setState({query:e.query}),this.context.executeAction(o.search,{query:e.query,filterQueryString:e.filterQueryString,pageNum:this.props.page,viewContext:e.viewContext,forum:e.currentForum,reset:this.props.filterQueryString!==e.filterQueryString,courseId:e.courseId}))},SearchResults.prototype.render=function render(){var i=this,r=this.context.router.isActive({pathname:v()}),h=!!this.context.router.params.item_id,u=!r&&!h,o=s()?this.props.currentForum.title:this.props.viewContext.getDisplayName(),y=s()?this.props.currentForumUrl:this.props.viewContext.get("discussionsLink"),l=void 0,g=e.createElement("a",{href:"#",onClick:this.handleSearchCourse,className:"nostyle search-course-link"},t("Search All Discussions")),f=e.createElement("div",{className:"results-metadata bgcolor-black-g1"},e.createElement("span",{className:"color-secondary-text"},this.props.loadingState===n.DONE?e.createElement(a,{message:t("{numResults} search results in {displayName}"),numResults:this.props.numResults,displayName:o}):e.createElement(a,{message:t("Finding search results in {displayName}"),displayName:o}),u&&" â€¢ ",u&&g));return this.props.loadingState===n.DONE&&this.props.currentResults.length>0&&(l=this.props.currentResults.map(function(t,s){return e.createElement(m,{key:s,index:s,entry:t,page:i.props.page,query:i.props.query,forumLink:y})})),e.createElement("div",{className:"rc-DiscussionsSearchResults"},e.createElement("div",{className:"results-container card-rich-interaction"},!r&&e.createElement("div",{className:"bgcolor-black-g1"},e.createElement("a",{href:"#",onClick:this.navigateBack,className:"nostyle back-area"},e.createElement("div",{className:"back-arrow"},e.createElement("i",{className:"cif-arrow-left back-arrow-image"})),e.createElement("span",{className:"back-label body-2-text"},t("Back to "+o)))),!r&&e.createElement(d,{query:this.state.query,handleSubmit:this.submitSearch,handleChange:this.handleQueryChange}),!r&&f,e.createElement(p,{loadingState:this.props.loadingState},l)),e.createElement(c,{onPageChange:this.onPageChange,pageCount:this.props.pageCount,currentPage:this.props.page,maxPages:5}))},SearchResults}(e.Component),r.propTypes={viewContext:e.PropTypes.instanceOf(F),currentForum:e.PropTypes.oneOfType([e.PropTypes.instanceOf(C),e.PropTypes.instanceOf(q)]),query:e.PropTypes.string.isRequired,pathname:e.PropTypes.string.isRequired,page:e.PropTypes.number.isRequired,loadingState:e.PropTypes.oneOf(Object.keys(n)),pageCount:e.PropTypes.number,currentResults:e.PropTypes.array,numResults:e.PropTypes.number,filterQueryString:e.PropTypes.string,rootPath:e.PropTypes.string,courseId:e.PropTypes.string,currentForumUrl:e.PropTypes.string},r.contextTypes={executeAction:e.PropTypes.func.isRequired,router:e.PropTypes.object.isRequired},i);module.exports=P(u(function(e){return{query:decodeURIComponent(e.location.query.q),pathname:e.location.pathname}}),w({fields:["title","link","forumType"]}),u(S),g(["DiscussionsSearchStore","SessionFilterStore"],function(n,e){var t=n.DiscussionsSearchStore,o=n.SessionFilterStore,r=s()?e.currentForum.forumId:e.viewContext.get("id");return{filterQueryString:o.activeFilterQueryString,currentResults:t.searchResults({forumId:r,query:e.query,pageNum:t.currentPage}),loadingState:t.loadingState,pageCount:t.getPageCount({forumId:r,query:e.query}),numResults:t.getNumResults({forumId:r,query:e.query})}}),f(function(e){return e.currentForum||e.viewContext}))(R)});